<%- include('partials/_header') %>
<script src="/socket.io/socket.io.js"></script>
<script>
  $(document).ready(function () {
    $('.cart').click(function (event) {
      $("#order_details").css("display", "block");
      $("#cart_header").html("Your order details:")
      let res = $(this).val().split(",")
      let row = `
      <tr>
        <input type='hidden' name='item' value='${res[0]},1'>
        <td>${res[1]}</td><td>1</td><td>$${res[2] / 100}</td></tr>
      `;
      $(".item_list").append(row);
      let currentTotal = $("#cart_total").html();
      let newTotal = Math.round((Number(currentTotal) + (res[2] / 100)) * 100) / 100;
      $("#cart_total").html(newTotal);
      $("#order_value").val(newTotal * 100);
      $(this).html("Added!").removeClass("btn-primary").addClass("btn-outline-success").attr("disabled", "disabled");

    })

    $("#order_details").submit(function (event) {
      event.preventDefault();
      let form = $(this);
      let data = form.serialize();
      console.log("Serialized data: ", data)
      $("#cart_header").html("Your order was sent!")
      $("#submit_order").html("Waiting for Restaurant to Accept Order").addClass("btn btn-warning text-white")
      $.ajax({
        type: 'POST',
        url: '/menu',
        data: form.serialize()
      })
    })
  })
</script>


<body>
  <nav class="navbar navbar-dark sticky-top" style="background-color: #07a7c4">
    <div class="container col-9">
      <span class="navbar-brand mb-0 h1">Habitual</span>
      <span class="navbar-text">
        Welcome, User!
      </span>
    </div>
  </nav>
  <div id="body" class="container col-9 mt-3">

    <div class="card-columns">

      <% for (let item of arr) { %>
      <div class="card">
        <img src="<%= item.picture_url %>" class="card-img-top">
        <div class="card-body">
          <h5 class="card-title"><%= item.name %></h5>
          <p class="card-text"><%= item.description %></p>
        </div>
        <div class="card-footer text-right">
          <span class="align-middle price">$<%= item.price/100 %></span>
          <button value="<%= item.id %>,<%= item.name %>,<%= item.price %>" class="btn btn-primary cart">Order</a>
        </div>
      </div>
      <% } %>

    </div>

    <!-- Cart -->
    <div class="container fixed-bottom">
      <div class="row">


        <div class="col-4 align-self-end rounded-top justify-content-end mt-1 bg-white shadow p-0">
          <header style="background-color: #07a7c4" class='p-2 text-white rounded-top'>
            <strong><span id='cart_header'>Your cart is empty.</span></strong>
          </header>
          <form action="/order" method="POST" id="order_details" style="display:none;">
            <section class="mt-2">
              <table class="table table-sm table-striped">
                <tbody class="item_list">
                </tbody>
              </table>
            </section>
            <input type="hidden" id="order_value" name="order_value" value="0">
            <footer class='text-center d-flex mb-2 justify-content-center'>
              <button id="submit_order" type="submit" class="btn btn-primary btn-sm btn-block w-75">Place Order | $<span
                  id="cart_total"></button>
          </form>
          </footer>


        </div>
      </div>
    </div>
    <!-- Footer -->
  </div>

  <%- include('partials/_footer') %>
